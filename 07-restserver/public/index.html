<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Google Sign-In</title>
  </head>
  <body>
    <h1>Google Sign-In</h1>
    <hr>
    <div id="g_id_onload"
         data-client_id="1311477318-2mstrcrqrbn1l2gni19e86rkq3ljio1a.apps.googleusercontent.com"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false"
         data-auto_select="true"
         >
      </div>
      <div class="g_id_signin"
         data-type="standard"
         data-size="large"
         data-theme="outline"
         data-text="sign_in_with"
         data-shape="rectangular"
         data-logo_alignment="left">
      </div>

    <button id="google_signout">
        Signout
    </button>

    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <script>
      function handleCredentialResponse(response) {
         //Google Token : ID_TOKEN
         //console.log('id_token', response.credential);
         const body={id_token:response.credential};// token que viene de google y que mandaremos bajo id_token

         fetch('http://localhost:8080/api/auth/google',{
           method:'POST',
           headers:{
             'Content-Type': 'application/json'
           },
           body: JSON.stringify(body)// para poder mandar el id_token via fetch tenemos que serializarlo
         })
              .then(r => r.json())// readable string que tenemos que abrir
              .then(resp => {
                console.log(resp) // consola que el backend va a regresar  - este console log lo veremos en el front
                localStorage.setItem('email',resp.usuario.correo) // guardamos el correo del user autenticado en el local storage.Necesario para el logout
              }).catch(console.warn);
      }

      const button = document.getElementById('google_signout');
      button.onclick = () => {

        console.log(google.accounts.id)
        
        google.accounts.id.disableAutoSelect()

        // Hacemos Logout usando 
        google.accounts.id.revoke(localStorage.getItem('email'),done =>{
          localStorage.clear();
          location.reload();
        })

      }

    </script>

  </body>
</html>
